version: "2"

linters:
  default: none
  enable:
    # Default linters
    - errcheck
    - govet
    - ineffassign
    - staticcheck  # includes gosimple and stylecheck in v2
    - unused

    # Security
    - gosec

    # Bug detection
    - bodyclose
    - durationcheck
    - errorlint
    - forcetypeassert
    - nilerr
    - noctx
    - rowserrcheck
    - sqlclosecheck

    # Code quality
    - cyclop
    - dupl
    - gocognit
    - goconst
    - gocritic
    - gocyclo
    - godot
    - misspell
    - nakedret
    - nestif
    - prealloc
    - predeclared
    - revive
    - thelper
    - unconvert
    - unparam
    - wastedassign
    - whitespace

    # Performance
    - makezero

    # Other
    - exhaustive
    - lll
    - nolintlint

  settings:
    gosec:
      severity: "medium"
      confidence: "medium"
      config:
        G101:
          pattern: "(?i)password|secret|key|token"
          ignore_entropy: false
          entropy_threshold: "80.0"
          per_char_threshold: "3.0"
          truncate: "32"

    cyclop:
      max-complexity: 15
      package-average: 10.0

    gocognit:
      min-complexity: 20

    goconst:
      min-len: 3
      min-occurrences: 3

    gocritic:
      enabled-tags:
        - diagnostic
        - experimental
        - opinionated
        - performance
        - style
      disabled-checks:
        - whyNoLint
        - wrapperFunc

    gocyclo:
      min-complexity: 15

    lll:
      line-length: 140
      tab-width: 4

    misspell:
      locale: UK

    nestif:
      min-complexity: 6

    revive:
      severity: warning
      rules:
        - name: blank-imports
        - name: context-as-argument
        - name: context-keys-type
        - name: dot-imports
        - name: error-return
        - name: error-strings
        - name: error-naming
        - name: exported
        - name: if-return
        - name: increment-decrement
        - name: var-naming
        - name: var-declaration
        - name: package-comments
        - name: range
        - name: receiver-naming
        - name: time-naming
        - name: unexported-return
        - name: indent-error-flow
        - name: errorf
        - name: empty-block
        - name: superfluous-else
        - name: unreachable-code

    staticcheck:
      checks: ["all", "-ST1000", "-ST1003", "-ST1016", "-ST1020", "-ST1021", "-ST1022"]

  exclusions:
    generated: lax
    rules:
      # Exclude some linters from running on tests files
      - path: _test\.go
        linters:
          - gocyclo
          - errcheck
          - dupl
          - gosec
          - gocognit
          - goconst
          - forcetypeassert
          - cyclop

      # Exclude known false positives
      - path: doc\.go
        linters:
          - lll

      # Allow long lines in comments
      - linters:
          - lll
        source: "^//|^\\s+//"

formatters:
  enable:
    - gofmt
    - goimports
  settings:
    gofmt:
      simplify: true
    goimports:
      local-prefixes:
        - github.com/sqrldev/server-go-ssp-gormauthstore

run:
  timeout: 5m
  tests: true
  build-tags:
    - integration
  modules-download-mode: readonly

output:
  formats:
    text:
      path: stdout
      colors: true
